# 測試套件執行指南

## 概述

本專案包含完整的測試套件，涵蓋 `git-auto-push.sh` 和 `git-auto-pr.sh` 的核心功能。

## 測試執行方式

### 1. 快速測試（推薦新手）

快速測試提供簡化的核心功能驗證，執行時間短，輸出清晰：

```bash
python3 test/quick_test.py
```

**特點：**

- 執行時間：約 10-20 秒
- 測試項目：5 個核心測試
- 輸出格式：彩色、結構化、易讀
- 適合：快速驗證、CI/CD 流程

**測試內容：**

1. 腳本檔案檢查
2. 腳本語法驗證
3. AI 工具配置檢查
4. Git 基本操作測試
5. 幫助信息測試

### 2. 完整測試套件

完整測試套件包含 81 個詳細測試案例：

```bash
# 執行所有測試
python3 test/run_all_tests.py

# 只測試 git-auto-push.sh
python3 test/run_all_tests.py --push

# 只測試 git-auto-pr.sh
python3 test/run_all_tests.py --pr

# 只執行整合測試
python3 test/run_all_tests.py --integration

# 詳細輸出模式
python3 test/run_all_tests.py --verbose

# 遇到第一個錯誤就停止
python3 test/run_all_tests.py --failfast
```

**特點：**

- 執行時間：約 2-5 分鐘
- 測試項目：81 個測試案例
- 覆蓋範圍：所有功能模組
- 適合：完整驗證、發布前檢查

### 3. 互動式測試腳本

```bash
bash test/quick_start.sh
```

提供互動式選單，可選擇執行特定測試。

## 測試組織結構

### git-auto-push.sh 測試（27 個測試）

**測試類別：**

- `TestGitAutoPushConfiguration` (4 tests) - 配置讀取和解析
- `TestGitAutoPushGitStatus` (4 tests) - Git 狀態檢查
- `TestGitAutoPushAITools` (3 tests) - AI 工具整合
- `TestGitAutoPushCommitMessage` (4 tests) - Commit 訊息驗證
- `TestGitAutoPushErrorHandling` (3 tests) - 錯誤處理
- `TestGitAutoPushInteraction` (3 tests) - 用戶互動
- `TestGitAutoPushWorkflows` (6 tests) - 工作流程

### git-auto-pr.sh 測試（36 個測試）

**測試類別：**

- `TestGitAutoPRConfiguration` (4 tests) - 配置和初始化
- `TestGitAutoPRBranchOperations` (8 tests) - 分支操作
- `TestGitAutoPRCreation` (8 tests) - PR 建立
- `TestGitAutoPRReview` (8 tests) - PR 審查和合併
- `TestGitAutoPRCancel` (8 tests) - PR 撤銷

### 整合測試（18 個測試）

**測試類別：**

- `TestFullWorkflowIntegration` (6 tests) - 完整工作流程
- `TestErrorRecovery` (6 tests) - 錯誤恢復
- `TestEdgeCases` (6 tests) - 邊界情況

## 已知問題與解決方案

### 問題 1：超時錯誤

**現象：**

```
subprocess.TimeoutExpired: Command timed out after 30 seconds
```

**原因：**

- 腳本等待用戶輸入
- AI 工具調用時間過長
- 網絡連接問題

**解決方案：**

1. 使用快速測試替代完整測試
2. 檢查 AI 工具是否正常工作
3. 確保網絡連接穩定

### 問題 2：編碼錯誤

**現象：**

```
UnicodeDecodeError: 'utf-8' codec can't decode byte
```

**解決方案：**
已在 `test_helpers.py` 中添加 `errors='replace'` 參數處理，並設置環境變數：

```python
env['LC_ALL'] = 'en_US.UTF-8'
env['LANG'] = 'en_US.UTF-8'
```

### 問題 3：Git 倉庫狀態

**現象：**
測試失敗因為 Git 倉庫狀態不正確

**解決方案：**
每個測試都會建立獨立的臨時 Git 倉庫，測試完成後自動清理。

## 測試輸出說明

### 成功測試

```
✓ PASS (0.055s)
```

### 失敗測試

```
✗ FAIL
```

### 錯誤測試

```
✗ ERROR
```

### 跳過測試

```
⊘ SKIP: 原因說明
```

## 測試最佳實踐

### 1. 開發前

執行快速測試確保環境正常：

```bash
python3 test/quick_test.py
```

### 2. 開發中

執行相關模組的測試：

```bash
# 修改 push 腳本後
python3 test/run_all_tests.py --push

# 修改 PR 腳本後
python3 test/run_all_tests.py --pr
```

### 3. 提交前

執行完整測試套件：

```bash
python3 test/run_all_tests.py --verbose
```

### 4. 發布前

執行所有測試包括整合測試：

```bash
python3 test/run_all_tests.py
```

## 測試環境要求

### 必需軟體

- Python 3.8+
- Git 2.0+
- Bash 4.0+

### 可選軟體（AI 功能）

- codex CLI
- gemini CLI
- claude CLI

## 持續改進

測試套件會持續改進以提供：

- 更快的執行速度
- 更清晰的輸出格式
- 更全面的覆蓋範圍
- 更好的錯誤報告

## 問題回報

如果遇到測試問題，請提供：

1. 測試命令
2. 完整輸出
3. 系統環境（OS、Python 版本、Git 版本）
4. 預期行為 vs 實際行為

## 參考資源

- 測試框架文檔：`test/README.md`
- 測試檢查清單：`test/測試檢查清單.md`
- 測試總結：`test/SUMMARY.md`
