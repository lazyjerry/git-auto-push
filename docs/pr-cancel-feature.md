# Pull Request 撤銷功能測試文檔

## 功能概述

「撤銷當前 PR」功能位於 git-auto-pr.sh 的選項 3。

## 主要功能

1. **智慧偵測當前分支的 PR 狀態**

   - 檢查 PR 是否存在
   - 識別 PR 狀態（OPEN, MERGED, CLOSED）

2. **開放中 PR 的安全處理選項**

   - 🚫 **關閉 PR（保留分支）**：關閉 PR 但保留功能分支，可稍後重新開啟
   - 📝 **添加評論後保持開放**：添加評論但保持 PR 開放狀態
   - ❌ **取消操作**：不執行任何操作

3. **已合併 PR 的處理**
   - 顯示合併資訊和合併後的 commit 數量
   - 提供 revert 選項（預設為否）
   - 安全檢查：顯示 revert 可能影響的後續 commit

## 使用流程

```bash
./git-auto-pr.sh
# 選擇選項 3（撤銷當前 PR）
# 系統自動檢測 PR 狀態並提供對應選項

# 針對開放中的 PR，系統提供 3 種安全選項：
# 1. 🚫 關閉 PR（保留分支）
# 2.  添加評論後保持開放
# 3. ❌ 取消操作

# 針對已合併的 PR：
# - 顯示合併後影響的 commit 資訊
# - 提供安全的 revert 選項（預設為否）
```

## 開放中 PR 的詳細操作

### 1. 關閉 PR（保留分支）

- 適用場景：暫時不需要此功能，但可能稍後繼續開發
- 操作結果：PR 狀態變為 CLOSED，分支保留
- 後續操作：可使用 `gh pr reopen` 重新開啟

### 2. 添加評論後保持開放

- 適用場景：需要記錄進度或與團隊溝通
- 操作結果：添加評論，PR 保持開放狀態
- 用途：狀態更新、進度報告、問題說明

### 3. 取消操作

- 適用場景：誤觸或決定不執行任何操作
- 操作結果：不做任何變更，回到主選單

**安全設計**：為避免意外的資料損失，此版本移除了刪除分支和轉換草稿等可能的破壞性操作。所有操作都以保護現有工作為優先考量。

## 安全特性

- **安全優先設計**：移除所有可能破壞性的操作（分支刪除、強制轉換等）
- **多重確認機制**：revert 操作需要明確確認
- **預設安全選項**：revert 操作預設為否
- **詳細影響分析**：顯示操作可能影響的 commit 和範圍
- **可逆操作支援**：保留分支的選項允許後續重新開啟
- **中斷恢復**：支援 Ctrl+C 優雅退出，不會留下中間狀態
- **錯誤輸入處理**：無效選項會重新顯示選單，不會退出程序

## 錯誤處理

- **分支檢查**：檢查當前分支是否為主分支，禁止在主分支操作
- **PR 存在性驗證**：檢查 PR 是否存在，提供其他選項
- **權限檢查**：驗證 GitHub CLI 登入狀態和倉庫權限
- **Git 操作驗證**：檢查分支切換操作的成功狀態
- **網絡錯誤處理**：GitHub API 調用失敗時提供詳細錯誤信息
- **備選方案**：找不到 PR 時提供檢查其他分支的選項

## 依賴需求

- GitHub CLI (gh) 已登入
- jq 工具（用於 JSON 解析）
- Git 倉庫環境
