# Git 工作流程自動化工具集 - 更新日誌

> 詳細記錄專案的版本更新歷史和功能變更

## 版本歷史

### v2.5.1 - 檔案過濾功能優化與可配置性提升 (2025-11-09)

**🆕 新功能**

- **檔案過濾功能開關** 🆕：新增 `ENABLE_FILE_FILTERING` 配置變數，提供靈活的檔案過濾控制
  - **配置位置**：`git-auto-push.sh` 第 181 行
  - **預設值**：`true`（啟用檔案過濾功能）
  - **停用效果**：直接執行 `git add .`，跳過檔案分析和過濾邏輯
  - **啟用效果**：讀取過濾檔案並按規則跳過指定檔案

**🔧 改進**

- **效能優化** ⚡：停用檔案過濾時直接使用 `git add .`，提升大型專案的執行速度
- **使用彈性** 🎯：用戶可根據專案需求和使用場景靈活選擇過濾模式
- **邏輯簡化** 🧹：精簡過濾檔案初始化內容，僅保留必要資訊
- **配置說明** 📖：新增詳細的配置說明和使用場景指導

**📊 行數統計更新**

- `git-auto-push.sh`：3065 行 → 3072 行（+7 行配置與邏輯優化）

**🎯 使用場景**

- **啟用檔案過濾**：適合需要選擇性提交、有臨時檔案需要保持 unstaged 的開發場景
- **停用檔案過濾**：適合個人專案、CI/CD 環境、快速提交所有變更的場景
- **動態切換**：可隨時修改配置值來切換模式，無需重新安裝

**⚙️ 配置方式**

```bash
# 啟用檔案過濾（預設）
ENABLE_FILE_FILTERING=true

# 停用檔案過濾（簡化模式）
ENABLE_FILE_FILTERING=false
```

**💡 效益提升**

- ✅ **彈性控制**：用戶可根據需求選擇是否使用檔案過濾
- ✅ **效能優化**：停用時跳過檔案分析，提升執行速度
- ✅ **簡化操作**：停用時直接使用標準 Git 操作，降低複雜度
- ✅ **向後相容**：預設啟用，不影響現有用戶的使用習慣

---

### v2.5.0 - 程式碼重構與專案清理 (2025-11-09)

**🔧 重構優化**

- **程式碼重構** ✨：統一使用 `get_git_status()` 函數取代重複的 `git status --porcelain` 調用
  - **重構位置**：3 處重複程式碼統一為單一函數調用
    - `add_all_files()` 函數中的 Git 狀態取得
    - `amend_last_commit()` 函數中的變更檢查
    - 倉庫資訊顯示功能中的工作區狀態
  - **維護性提升**：遵循 DRY（Don't Repeat Yourself）原則
  - **統一錯誤處理**：所有 Git 狀態取得都使用相同的錯誤處理機制
  - **易於修改**：未來需要調整 Git 狀態取得邏輯時，只需修改一個函數

- **中文檔案名稱修復** 🐛：修復中文檔案名稱在 Git 中的顯示問題
  - **根本原因**：Git 預設將非 ASCII 字元轉換為十六進制編碼
  - **修復方案**：設定 `git config core.quotepath false` 正確處理中文
  - **修復範圍**：影響所有包含中文字元的檔案名稱處理

- **Git Rename 操作處理** 🛠️：改善腳本對 Git rename 操作的處理邏輯
  - **問題修復**：腳本現在能正確識別並跳過已暫存的 rename 操作
  - **狀態處理**：新增 case 語句區分不同的 Git 狀態碼（R、D、A、M 等）
  - **調試輸出**：增強調試訊息，清楚顯示每個檔案的處理狀態

**🧹 專案清理**

- **檔案管理** 🗑️：移除 .DS_Store 檔案並建立完整的 .gitignore
  - **清理範圍**：從 Git 追蹤中移除所有 .DS_Store 檔案
  - **預防機制**：新增 .gitignore 檔案防止未來意外提交系統檔案
  - **涵蓋內容**：macOS 系統檔案、編輯器暫存檔、日誌檔案、臨時檔案

- **文件結構整理** 📁：重新整理文件結構，所有報告移至 `docs/reports/` 目錄
  - **統一管理**：所有功能文件和開發報告集中管理
  - **視覺化文件**：新增 Mermaid 流程圖和工作流程示意圖
  - **中文檔案**：正確處理包含中文的文件檔名

**📊 行數統計更新**

- `git-auto-push.sh`：3047 行 → 3065 行（+18 行重構優化）
- `git-auto-pr.sh`：2896 行 → 3135 行（+239 行功能增強）

**🎯 重構效益**

- ✅ **維護性提升**：統一的程式碼介面，減少重複程式碼
- ✅ **穩定性增強**：修復中文檔案名稱和 rename 操作處理問題
- ✅ **專案整潔**：清理系統檔案，建立完整的忽略規則
- ✅ **文件完善**：清楚的文件結構和流程圖表
- ✅ **程式碼品質**：遵循最佳實踐，提高程式碼可讀性

---

### v2.4.0 - 檔案過濾功能 (2025-11-09)

**🆕 新功能**

- **檔案過濾系統** 🆕：選擇性 git add 機制，自動過濾符合規則的檔案
  - **過濾規則檔案**：`git-auto-push-ignore.txt`（首次使用自動建立）
  - **Glob Pattern 支援**：完整支援 `*` 和 `**` 萬用字元，格式同 `.gitignore`
  - **路徑智慧處理**：
    - 自動識別相對路徑和絕對路徑
    - 相對路徑以執行目錄為基準
    - 顯示實際使用的完整路徑
  - **權限檢查機制**：
    - 檔案建立權限驗證
    - 讀取權限檢查
    - 詳細錯誤提示和修復建議
  - **動態回饋**：
    - 顯示被忽略的檔案清單（符合過濾規則）
    - 顯示成功添加的檔案數量
    - 提供過濾檔案編輯路徑

**🔧 改進**

- **操作模式說明更新**：所有涉及 add 的模式都標註支援檔案過濾
  - 模式 1：完整流程（支援檔案過濾）
  - 模式 2：本地提交（支援檔案過濾）
  - 模式 3：僅添加變更（自動過濾符合規則的檔案）
  - 模式 4：全自動流程（支援檔案過濾）
- **配置變數**：新增 `IGNORE_FILE_PATH` 變數（約 185 行）
  - 預設值：`git-auto-push-ignore.txt`
  - 支援相對路徑和絕對路徑
  - 可自訂過濾檔案位置

**📊 行數統計更新**

- `git-auto-push.sh`：2731 行 → 3065 行（+334 行新功能與優化）

**🎯 使用場景**

- ✅ 臨時檔案：不想加入 `.gitignore`，但也不想每次都 add
- ✅ 實驗性修改：保持在 unstaged 方便隨時丟棄
- ✅ 敏感配置：開發環境的設定檔
- ✅ 測試檔案：開發階段的測試腳本

**⚙️ 過濾檔案範例**

```bash
# git-auto-push-ignore.txt
*.log                    # 忽略所有 log 檔
test-*.sh                # 忽略測試腳本
docs/draft/              # 忽略草稿目錄
**/temp/*                # 忽略所有 temp 目錄下的檔案
config/local.*.json      # 忽略本地配置檔
```

---

### v2.3.0 - 任務編號整合與調試模式 (2025-11-09)

**🆕 新功能**

- **任務編號自動帶入** 🆕：從分支名稱自動偵測並加入 issue key 前綴
  - 智慧解析：支援 JIRA、GitHub Issue 等多種編號格式（如 `PROJ-123`、`feat-001`）
  - 靈活配置：支援自動模式（預設）和詢問模式
  - 重複檢測：避免重複加入任務編號
  - 整合範圍：涵蓋所有 commit 操作（包括選項 1、2、4、5、7）
  - 分支命名：自動從分支名稱（如 `jerry/feature/feat-001`）提取任務編號

- **調試模式** 🆕：開發階段的 AI 工具執行詳情追蹤
  - 完整日誌：記錄 AI 工具的輸入提示詞、diff 內容、輸出結果
  - 錯誤診斷：超時、執行失敗、無輸出等情況的詳細資訊
  - 可配置：透過 `IS_DEBUG` 變數開關（預設關閉）
  - 開發友善：協助問題排查和 AI 提示詞優化

**🔧 改進**

- Commit 訊息流程優化：所有 commit 輸入點統一支援任務編號
- 使用者提示增強：清楚顯示任務編號偵測狀態和帶入模式
- 配置變數整合：統一的 `AUTO_INCLUDE_TICKET` 配置管理

**⚙️ 配置方式**

```bash
# 任務編號配置（git-auto-push.sh 約第 131 行）
AUTO_INCLUDE_TICKET=true   # 自動加入（預設）
AUTO_INCLUDE_TICKET=false  # 詢問模式

# 調試模式配置（git-auto-push.sh 約第 156 行）
IS_DEBUG=false  # 一般使用（預設）
IS_DEBUG=true   # 開發調試
```

**📊 行數統計**

- `git-auto-push.sh`：2184 行 → 2731 行（+547 行，包含任務編號、品質檢查、調試模式等功能）

**🎯 使用場景**

- ✅ 自動關聯 commit 與 issue tracking 系統
- ✅ 保持 commit 訊息格式一致性
- ✅ 團隊協作時快速定位相關任務
- ✅ AI 工具問題診斷與提示詞優化

---

### v2.2.1 - 使用者體驗優化 (2025-11-08)

**🔧 改進**

- **AI 訊息確認提示優化**：改善「是否使用此訊息？」的使用者引導
  - 新增「💡 下一步動作：」明確說明
  - 根據 `AUTO_CHECK_COMMIT_QUALITY` 配置動態顯示下一步流程
  - 清楚標示按 Enter 或 y 的行為（使用訊息並檢查品質 vs 稍後詢問）
  - 統一提示格式，提升操作透明度

**📊 行數統計更新**

- `git-auto-push.sh`：2701 行（+17 行使用者體驗改進）

**🎯 改進效果**

- ✅ 使用者更清楚接受訊息後的下一步流程
- ✅ 減少操作意外和疑惑
- ✅ 根據配置提供精確的操作預期

---

### v2.2.0 - Commit 訊息品質檢查功能 (2025-11-08)

**🆕 新功能**

- **AI 驅動的品質檢查** 🆕：新增 commit 訊息品質檢查功能
  - 智慧分析：使用 AI 檢查訊息是否明確描述變更內容和目的
  - 彈性配置：支援自動檢查（預設）和詢問模式
  - 容錯設計：AI 工具失敗時自動跳過，不影響提交流程
  - 友善提示：品質不良時提供警告和改進建議
- **配置變數** 🆕：新增 `AUTO_CHECK_COMMIT_QUALITY` 變數控制檢查行為
  - `true`（預設）：每次 commit 前自動檢查
  - `false`：提交前詢問是否檢查（預設為否）

**🔧 改進**

- 品質標準定義：區分良好和不良的 commit 訊息範例
- 操作流程優化：自然整合至現有提交流程
- 說明文件完善：新增詳細的功能說明和使用指導

**📁 新增文檔**

- `docs/reports/FEATURE-COMMIT-QUALITY.md` - Commit 品質檢查功能詳細說明
- `docs/reports/COMMIT-QUALITY-SUMMARY.md` - 品質檢查功能摘要
- `docs/reports/COMMIT-QUALITY-QUICKREF.md` - 快速參考指南
- `docs/reports/AI-QUALITY-CHECK-IMPROVEMENT.md` - AI 品質檢查改進說明

**📊 行數統計**

- `git-auto-push.sh`：維持 2184 行（功能整合優化）

**🎯 使用場景**

- ✅ 確保 commit 訊息清晰描述變更內容
- ✅ 培養團隊良好的提交習慣
- ✅ 維護高品質的專案提交歷史
- ✅ 避免模糊或無意義的 commit 訊息

**⚙️ 配置方式**

```bash
# 修改 git-auto-push.sh 約 149 行
# 自動檢查模式（預設）
AUTO_CHECK_COMMIT_QUALITY=true

# 詢問模式
AUTO_CHECK_COMMIT_QUALITY=false
```

---

### v2.1.0 - Commit 訊息修改功能 (2025-11-02)

**🆕 新功能**

- **變更最後一次 commit 訊息** 🆕：新增選項 7，安全修改最近一次提交的訊息
  - 智慧安全檢查：自動偵測未提交的變更並警告
  - 參考訊息顯示：修改前顯示目前的 commit 訊息
  - 任務編號整合：支援自動帶入或詢問加入任務編號前綴
  - 二次確認機制：顯示完整新訊息並要求確認
  - 清楚反饋：成功後顯示修改結果
- **快速選項** 🆕：無變更時提供 p/7/6 快速選項（推送/修改/查看）
- **黃色訊息函數** 🆕：新增 `yellow_msg()` 用於重要提示

**🔧 改進**

- 操作模式擴展：從 6 選項擴展為 7 選項
- 選單更新：輸入提示範圍更新為 `[1-7]`
- 說明文件完善：新增「7️⃣ 變更最後一次 commit 訊息」完整說明
- 無變更流程優化：提供更多操作選項而非僅推送

**📁 新增文檔**

- `docs/reports/FEATURE-AMEND.md` - 變更 commit 訊息功能詳細說明

**📊 行數統計更新**

- `git-auto-push.sh`：2184 行（+129 行新功能）

**⚠️ 使用注意**

- ✅ 適用於尚未推送的本地 commit
- ⚠️ 避免修改已推送至遠端的 commit
- 💡 團隊協作時建議使用新 commit 而非 amend

---

### v2.0.0 - 程式碼品質與分支管理提升 (2025-10-24)

**新功能**

- **可配置分支刪除策略** 🆕：PR 合併後分支處理策略
  - 預設值：`false`（保守策略，保留分支）
  - 可配置：`true`（自動刪除）或 `false`（保留分支）
  - 位置：`git-auto-pr.sh` 第 217 行
  - 影響範圍：「審查與合併 PR」功能（選項 4）

**🔧 改進**

- **分支管理流程**：根據配置自動選擇合併策略
  - `AUTO_DELETE_BRANCH_AFTER_MERGE=true`：使用 `gh pr merge --squash --delete-branch`
  - `AUTO_DELETE_BRANCH_AFTER_MERGE=false`：使用 `gh pr merge --squash`（保留分支）
- **提示訊息**：合併後顯示分支保留狀態與後續操作建議
- **配置說明**：詳細的註解說明配置用途、安全考量與修改範例

**📊 行數統計更新**

- `git-auto-pr.sh`：2872 行 → 2896 行（+24 行配置與邏輯）

**🎯 使用場景**

- **保留分支（預設）**：適合需要追蹤功能分支歷史的專案
- **自動刪除**：適合短期功能分支，保持倉庫整潔

**⚙️ 配置方式**

```bash
# 修改 git-auto-pr.sh 第 217 行
# 保留分支（預設）
readonly AUTO_DELETE_BRANCH_AFTER_MERGE=false

# 自動刪除分支
readonly AUTO_DELETE_BRANCH_AFTER_MERGE=true
```

---

### v1.6.0 - 流程註解完善與文件更新 (2025-10-24)

**🔧 改進**

- 流程函數註解更新：為所有主要工作流程函數添加註解
  - `execute_full_workflow()` - Git 流程（add → commit → push）
  - `execute_local_commit()` - 本地提交流程（add → commit）
  - `execute_add_only()` - 僅添加檔案流程
  - `execute_create_branch()` - 功能分支建立流程
  - `execute_create_pr()` - Pull Request 建立流程
- 註解標準化：統一函數註解格式，包含功能、參數、流程、副作用、參考
- 步驟編號優化：流程內步驟重新編號，更清晰反映實際執行順序
- 文件更新：README 更新最新行數統計與版本資訊

**📊 行數統計更新**

- `git-auto-push.sh`：1655 行（+49 行流程註解）
- `git-auto-pr.sh`：2872 行（+43 行流程註解）

---

### v1.5.0 - Git 倉庫資訊查看功能 (2025-10-21)

**🆕 新功能**

- Git 倉庫資訊顯示：新增選項 6，提供完整的 Git 倉庫狀態概覽
  - 當前分支名稱和倉庫路徑
  - 所有遠端倉庫 URL（fetch 和 push）
  - 追蹤分支資訊和設定狀態
  - 同步狀態分析（領先/落後提交數）
  - 分支來源追蹤（從哪個主分支分出）
  - 最近 5 筆 commit 歷史記錄
  - 工作區狀態檢查（未提交變更）

**🔧 改進**

- 選單擴展：從 5 選項擴展為 6 選項，新增倉庫資訊查看
- 分析功能：自動判斷分支來源和與主分支的關係
- 彩色輸出：使用顏色和 emoji 增強資訊可讀性
- 安全設計：純查詢操作，不會修改任何 Git 狀態

**📁 新增文檔**

- `docs/git-info-feature.md` - Git 倉庫資訊功能詳細說明

**📊 行數統計更新**

- `git-auto-push.sh`：1372 行（+78 行新功能）

---

### v1.4.1 - 分支管理系統與程式碼文件化 (2025-10-04)

**🆕 新功能**

- **分支刪除系統** 🆕：新增安全的分支刪除功能，支援本地和遠端分支清理
- **主分支保護機制**：絕對禁止刪除主分支，可設定 DEFAULT_MAIN_BRANCHES 變數
- **當前分支處理**：自動偵測當前分支，提供切換後刪除的安全流程
- **多重確認機制**：分級確認系統，防止誤刪重要分支
- **程式碼文件** ✨：為所有主要函數加入註解標準

**🔧 改進**

- 選單擴展：從 4 選項擴展為 5 選項，新增分支管理功能
- 安全設計：未合併分支需要額外確認，已合併分支可安全刪除
- 遠端同步：可選擇同時刪除對應的遠端分支
- 偵測機制：自動識別分支狀態和合併情況
- **程式碼品質提升**：
  - 統一函數註解格式（功能、參數、返回值、使用範例）
  - 檔案標頭文件（版本、作者、使用指南、系統需求）
  - 詳細的安全機制和錯誤處理說明
  - 程式碼標準實施

**📊 行數統計更新**

- `git-auto-push.sh`：1294 行（+54 行註解）
- `git-auto-pr.sh`：2263 行（+163 行註解）

---

### v1.3.0 - PR 撤銷功能與選單重構 (2025-09-15)

**🆕 新功能**

- **PR 撤銷系統**：新增 PR 撤銷功能，支援開放中 PR 關閉和已合併 PR 的 revert
- **安全檢查機制**：顯示合併後影響的 commit 數量，revert 操作預設為否
- **選單結構優化**：將 PR 管理子選項提升為主選項，操作更直觀

**🔧 改進**

- 選單重構：從 3 選項擴展為 4 選項，移除子選單層級
- 分析功能：檢測 PR 狀態並提供對應操作選項（關閉/revert）
- 安全設計：所有破壞性操作都需要用戶明確確認

**📁 新增文檔**

- `docs/pr-cancel-feature.md` - PR 撤銷功能詳細說明

**📊 行數統計更新**

- `git-auto-pr.sh`：1876 行（+426 行）

---

### v1.2.0 - 分支配置系統 (2025-09-14)

**🆕 新功能**

- 分支配置：git-auto-pr.sh 新增 `DEFAULT_MAIN_BRANCHES` 陣列配置
- 自動偵測機制：按優先順序自動偵測第一個存在的主分支
- 錯誤處理優化：找不到分支時提供詳細解決建議和動態修復指令

**🔧 改進**

- 配置集中化：所有分支相關設定移至檔案頂部
- 錯誤訊息彩色化：使用表情符號和顏色提升可讀性
- 動態建議生成：根據配置陣列自動產生對應的 Git 指令

**⚙️ 設定位置**

- `git-auto-pr.sh` 第 78 行：`readonly -a DEFAULT_MAIN_BRANCHES=("main" "master")`

---

### v1.1.0 - AI 配置整合 (2025-09-13)

**🔧 重構**

- AI 提示詞提取至檔案頂部作為配置變數
- 統一 AI_TOOLS 變數，便於維護
- 新增 README 開發修改指導說明

---

## 版本統計

- **最新版本**：v2.5.1 (2025-11-09)
- **總版本數**：14 個主要版本
- **開發期間**：2025-09-13 至 2025-11-09
- **功能里程碑**：
  - v1.x：基礎功能和 PR 管理
  - v2.0：程式碼品質提升
  - v2.1-v2.2：Commit 功能增強
  - v2.3-v2.4：進階功能和過濾系統
  - v2.5：程式碼重構和專案優化
  - v2.5.1：檔案過濾功能優化

## 相關文檔

- [README.md](README.md) - 專案主要說明
- [docs/reports/](docs/reports/) - 詳細功能報告
- [.github/copilot-instructions.md](.github/copilot-instructions.md) - 開發指導

---

*本更新日誌遵循 [Keep a Changelog](https://keepachangelog.com/) 格式規範*